<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Heike Hofmann, Craig Orman, Naga Vempati">

<title>Scan Quality Assessor: Model Comparison</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Model Comparison_files/libs/clipboard/clipboard.min.js"></script>
<script src="Model Comparison_files/libs/quarto-html/quarto.js"></script>
<script src="Model Comparison_files/libs/quarto-html/popper.min.js"></script>
<script src="Model Comparison_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Model Comparison_files/libs/quarto-html/anchor.min.js"></script>
<link href="Model Comparison_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Model Comparison_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Model Comparison_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Model Comparison_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Model Comparison_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul></li>
  <li><a href="#feature-analysis" id="toc-feature-analysis" class="nav-link" data-scroll-target="#feature-analysis">Feature Analysis</a>
  <ul class="collapse">
  <li><a href="#assess-percentile-na-proportion" id="toc-assess-percentile-na-proportion" class="nav-link" data-scroll-target="#assess-percentile-na-proportion">Assess Percentile NA Proportion</a></li>
  <li><a href="#assess-col-na" id="toc-assess-col-na" class="nav-link" data-scroll-target="#assess-col-na">Assess Col NA</a></li>
  <li><a href="#extract-na" id="toc-extract-na" class="nav-link" data-scroll-target="#extract-na">Extract NA</a></li>
  <li><a href="#assess-middle-na-proportion" id="toc-assess-middle-na-proportion" class="nav-link" data-scroll-target="#assess-middle-na-proportion">Assess Middle NA Proportion</a></li>
  <li><a href="#assess-rotation" id="toc-assess-rotation" class="nav-link" data-scroll-target="#assess-rotation">Assess Rotation</a></li>
  <li><a href="#assess-bottomempty" id="toc-assess-bottomempty" class="nav-link" data-scroll-target="#assess-bottomempty">Assess Bottomempty</a></li>
  <li><a href="#assess-median-na-proportion" id="toc-assess-median-na-proportion" class="nav-link" data-scroll-target="#assess-median-na-proportion">Assess Median NA Proportion</a></li>
  <li><a href="#cross-correlations" id="toc-cross-correlations" class="nav-link" data-scroll-target="#cross-correlations">Cross Correlations</a></li>
  </ul></li>
  <li><a href="#standard-model-analysis" id="toc-standard-model-analysis" class="nav-link" data-scroll-target="#standard-model-analysis">Standard Model Analysis</a>
  <ul class="collapse">
  <li><a href="#standard-multi-nomial-logistic-regression" id="toc-standard-multi-nomial-logistic-regression" class="nav-link" data-scroll-target="#standard-multi-nomial-logistic-regression">Standard Multi-Nomial Logistic Regression</a></li>
  <li><a href="#standard-binary-regression" id="toc-standard-binary-regression" class="nav-link" data-scroll-target="#standard-binary-regression">Standard Binary regression</a></li>
  <li><a href="#standard-ordinal-random-forest" id="toc-standard-ordinal-random-forest" class="nav-link" data-scroll-target="#standard-ordinal-random-forest">Standard Ordinal random forest</a></li>
  <li><a href="#standard-numerical-random-forest" id="toc-standard-numerical-random-forest" class="nav-link" data-scroll-target="#standard-numerical-random-forest">Standard Numerical Random Forest</a></li>
  <li><a href="#standard-model-results" id="toc-standard-model-results" class="nav-link" data-scroll-target="#standard-model-results">Standard Model Results</a></li>
  </ul></li>
  <li><a href="#cropped-feature-analysis" id="toc-cropped-feature-analysis" class="nav-link" data-scroll-target="#cropped-feature-analysis">Cropped Feature Analysis</a>
  <ul class="collapse">
  <li><a href="#extract-na-cropped" id="toc-extract-na-cropped" class="nav-link" data-scroll-target="#extract-na-cropped">Extract NA Cropped</a></li>
  <li><a href="#assess-bottomempty-cropped" id="toc-assess-bottomempty-cropped" class="nav-link" data-scroll-target="#assess-bottomempty-cropped">Assess Bottomempty Cropped</a></li>
  <li><a href="#assess-col-na-cropped" id="toc-assess-col-na-cropped" class="nav-link" data-scroll-target="#assess-col-na-cropped">Assess Col NA Cropped</a></li>
  <li><a href="#assess-median-na-proportion-cropped" id="toc-assess-median-na-proportion-cropped" class="nav-link" data-scroll-target="#assess-median-na-proportion-cropped">Assess Median NA Proportion Cropped</a></li>
  </ul></li>
  <li><a href="#cropped-model-analysis" id="toc-cropped-model-analysis" class="nav-link" data-scroll-target="#cropped-model-analysis">Cropped Model Analysis</a>
  <ul class="collapse">
  <li><a href="#cropped-multi-nomial-logistic-regression" id="toc-cropped-multi-nomial-logistic-regression" class="nav-link" data-scroll-target="#cropped-multi-nomial-logistic-regression">Cropped Multi-Nomial Logistic Regression</a></li>
  <li><a href="#cropped-binary-logistic-regression" id="toc-cropped-binary-logistic-regression" class="nav-link" data-scroll-target="#cropped-binary-logistic-regression">Cropped Binary Logistic Regression</a></li>
  <li><a href="#cropped-ordinal-random-forest" id="toc-cropped-ordinal-random-forest" class="nav-link" data-scroll-target="#cropped-ordinal-random-forest">Cropped Ordinal Random Forest</a></li>
  <li><a href="#cropped-binary-random-forest" id="toc-cropped-binary-random-forest" class="nav-link" data-scroll-target="#cropped-binary-random-forest">Cropped Binary Random Forest</a></li>
  <li><a href="#cropped-model-results" id="toc-cropped-model-results" class="nav-link" data-scroll-target="#cropped-model-results">Cropped Model Results</a></li>
  </ul></li>
  <li><a href="#final-results" id="toc-final-results" class="nav-link" data-scroll-target="#final-results">Final Results</a></li>
  <li><a href="#followup-scans" id="toc-followup-scans" class="nav-link" data-scroll-target="#followup-scans">Followup Scans</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Scan Quality Assessor: Model Comparison</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Heike Hofmann, Craig Orman, Naga Vempati </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This document is intended give well commented exact technical details to show the comparison of various models we tested and compared to determine the best candidate for use in a research or real-world environment.</p>
<p>We will investigate the ability of our features to predict the quality of a scan using a variety of methods. It should be noted that given our current classification system Good &gt; Tiny Problems &gt; Problematic &gt; Bad &gt; Yikes, we will consider that any scan worse than Tiny Problems should be re-scanned by the user. However, this is a tool meant to aid a user in deciding and is not to be taken as a sole source of truth.</p>
<p>Models will be broken into two classification types, ordinal and binary. In the ordinal models, we will try to accurately predict which of the five categories a scan falls into. As quality is a subjective rating, we will focus more on being within one step of the assigned rating than going for perfect agree, although perfect agreement would be optimal. In the binary setting, we will group the scans as Good (1) and Bad (0) as binary classifications are often easier. Good (1) scans will be scans currently labelled as Good or Tiny Problems, with Bad (0) scans being Problematic, Bad, and Yikes.</p>
<p>There will also be a comparison of models between using the features calculated against a full image as taken by the scanner, and a cropped image of the scan. The purpose of this is to increase the speed of the quality assurance stage, and to see if removing the ‘noise’ at the sides of the image helps to increase the estimate of quality, as our focus is on the center of the image.</p>
<ul>
<li><span style="color: red;">XXX Is there a more mathy and rigorous reason we chose these models? They are pretty much just my go-tos, and the only ones I know for categorical. Probably need to add references</span></li>
</ul>
<p>The models we will train are logistic regressions, and random forests. These models have often proven to be sufficiently explainable for forensic purposes, as well as statistically sound in many environments.</p>
<section id="results" class="level3">
<h3 class="anchored" data-anchor-id="results">Results</h3>
<ul>
<li><span style="color: red;">XXX Interpret the results</span></li>
</ul>
<table class="table">
<colgroup>
<col style="width: 39%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>TPR</th>
<th>TNR</th>
<th>F1 Score</th>
<th>Kappa</th>
<th>AUC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Stnd Multinomial Logistic Regression</td>
<td><strong>0.9821</strong></td>
<td>0.6786</td>
<td>0.9283</td>
<td>0.7191</td>
<td>0.8304</td>
</tr>
<tr class="even">
<td>Stnd Binary Logistic Regression</td>
<td>0.9643</td>
<td>0.7714</td>
<td>0.9364</td>
<td>0.7677</td>
<td><strong>0.9533</strong></td>
</tr>
<tr class="odd">
<td>Stnd Ordinal Random Forest</td>
<td>0.9643</td>
<td>0.7714</td>
<td>0.9364</td>
<td>0.7677</td>
<td>0.8304</td>
</tr>
<tr class="even">
<td>Stnd Binary Random Forest</td>
<td>0.9286</td>
<td><strong>0.8286</strong></td>
<td>0.9286</td>
<td>0.7571</td>
<td>0.9477</td>
</tr>
<tr class="odd">
<td>Crop Multinomial Logistic Regression</td>
<td><strong>0.9821</strong></td>
<td>0.7</td>
<td>0.9322</td>
<td>0.7375</td>
<td>0.8411</td>
</tr>
<tr class="even">
<td>Crop Binary Logistic Regression</td>
<td>0.9554</td>
<td>0.7929</td>
<td>0.9359</td>
<td>0.7707</td>
<td>0.9514</td>
</tr>
<tr class="odd">
<td>Crop Ordinal Random Forest</td>
<td>0.9554</td>
<td>0.8</td>
<td><strong>0.9372</strong></td>
<td><strong>0.7764</strong></td>
<td>0.8777</td>
</tr>
<tr class="even">
<td>Crop Binary Random Forest</td>
<td>0.9375</td>
<td><strong>0.8286</strong></td>
<td>0.9333</td>
<td>0.7709</td>
<td>0.9503</td>
</tr>
</tbody>
</table>
<p>Data handling and type setting</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-2_48b6a080ef3d9320b559a79e570a84ed">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>full.data <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"../data/std_and_cropped_data_12_20_2022.csv"</span>, <span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>full.data <span class="ot">&lt;-</span> full.data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Quality =</span> <span class="fu">factor</span>(Quality, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Good"</span>, <span class="st">"Tiny Problems"</span>, <span class="st">"Problematic"</span>, <span class="st">"Bad"</span>, <span class="st">"Yikes"</span>), <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Problem =</span> <span class="fu">factor</span>(Problem, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Good"</span>, <span class="st">"Damage"</span>, <span class="st">"Holes"</span>, <span class="st">"Feathering"</span>, <span class="st">"Rotation-Staging"</span>), <span class="at">ordered =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">GoodScan =</span> Quality <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Good"</span>, <span class="st">"Tiny Problems"</span>) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">LAPD_id =</span> <span class="fu">sprintf</span>(<span class="st">"FAU%3d-B%s-L%d"</span>,FAU, Bullet, Land),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is the features ran against the full image</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_percentile_na_proportion =</span> <span class="fu">as.numeric</span>(assess_percentile_na_proportion),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_col_na =</span> <span class="fu">as.numeric</span>(assess_col_na),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">extract_na =</span> <span class="fu">as.numeric</span>(extract_na),</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_middle_na_proportion =</span> <span class="fu">as.numeric</span>(assess_middle_na_proportion),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_rotation =</span> <span class="fu">as.numeric</span>(assess_rotation),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_bottomempty =</span> <span class="fu">as.numeric</span>(assess_bottomempty),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_median_na_proportion =</span> <span class="fu">as.numeric</span>(assess_median_na_proportion),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is the features ran against the cropped image</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_percentile_na_proportion_cropped =</span> <span class="fu">as.numeric</span>(assess_percentile_na_proportion_cropped),</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_col_na_cropped =</span> <span class="fu">as.numeric</span>(assess_col_na_cropped),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">extract_na_cropped =</span> <span class="fu">as.numeric</span>(extract_na_cropped),</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_bottomempty_cropped =</span> <span class="fu">as.numeric</span>(assess_bottomempty_cropped),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">assess_median_na_proportion_cropped =</span> <span class="fu">as.numeric</span>(assess_median_na_proportion_cropped)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>followupScans <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="feature-analysis" class="level2">
<h2 class="anchored" data-anchor-id="feature-analysis">Feature Analysis</h2>
<p>In this investigation, we are going to look at the features calculated against the full image. This investigation will tell us more about the predictive power of each feature, and tell us how different the quality categories are from each other.</p>
<ul>
<li><span style="color: red;">XXX Our results are mostly in graphical form. Should I use some kinda test? Is there a way to front load the results as with models?</span></li>
</ul>
<section id="assess-percentile-na-proportion" class="level3">
<h3 class="anchored" data-anchor-id="assess-percentile-na-proportion">Assess Percentile NA Proportion</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-4_cc155cd244019dd580f76e9f7e2b3a08">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(standard.data<span class="sc">$</span>assess_percentile_na_proportion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.00331 0.01088 0.02073 0.02716 0.25525 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(standard.data, <span class="fu">aes</span>(<span class="at">x=</span>Quality, <span class="at">y=</span>assess_percentile_na_proportion)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Assess Percentile NA Proportion by Quality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure shows a box plot with the 5 categorical quality levels on the X axis and the Assess percentile na proportion on the Y axis. The good scans show a tight clustering around 0.0 on the Y axis. As the quality of the scan decreases the median increases, and the variance increases as well. The rate of increase in assess percentile na proportion by level is similar to a linear increase. This boxplot shows that higher quality is associated with a lower assess percentile na proportion.</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(Quality <span class="sc">~</span> assess_percentile_na_proportion,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>standard.data, <span class="at">family=</span><span class="st">"binomial"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Quality ~ assess_percentile_na_proportion, family = "binomial", 
    data = standard.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.0868   0.0000   0.0104   0.2550   1.4413  

Coefficients:
                                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                      -0.6017     0.1206  -4.991 6.02e-07 ***
assess_percentile_na_proportion 585.1354    45.1784  12.952  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1476.42  on 1849  degrees of freedom
Residual deviance:  782.01  on 1848  degrees of freedom
AIC: 786.01

Number of Fisher Scoring iterations: 10</code></pre>
</div>
</div>
<p>In the boxplot we can see that as Assess Percentile NA Proportion increases, the quality of the image decreases. The IQR of the quality categories has overlap, but the medians are consistently different in the chart. The logistic regression also shows that there is overwhelming evidence, with reservation, for this being a useful feature in explaining the quality.</p>
<ul>
<li><span style="color: red;">XXX What does the warning mean here and how do we address it?</span></li>
</ul>
</section>
<section id="assess-col-na" class="level3">
<h3 class="anchored" data-anchor-id="assess-col-na">Assess Col NA</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-5_8f35a7d395ea3eeb719608ad0cfec3a5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(standard.data<span class="sc">$</span>assess_col_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.2573  0.9244  1.0755  1.1654  1.2928  4.3684 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(standard.data, <span class="fu">aes</span>(<span class="at">x=</span>Quality, <span class="at">y=</span>assess_col_na)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Assess Col NA by Quality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure shows a box plot with the 5 categorical quality levels on the X axis and the assess col na on the Y axis. The good scans show a tight clustering around 0.9 on the Y axis. As the quality of the scan decreases the median increases, and the variance increases as well. The rate of increase is similar to the start of an exponential chart where the rate of change increases over time. This boxplot shows that higher quality is associated with a lower assess col na.</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(Quality <span class="sc">~</span> assess_col_na,</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>standard.data, <span class="at">family=</span><span class="st">"binomial"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Quality ~ assess_col_na, family = "binomial", data = standard.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.3488   0.1629   0.4009   0.5954   1.8298  

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -2.5752     0.3593  -7.167 7.66e-13 ***
assess_col_na   4.3089     0.3727  11.563  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1476.4  on 1849  degrees of freedom
Residual deviance: 1269.5  on 1848  degrees of freedom
AIC: 1273.5

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>In the boxplot we can see that as Assess Col NA increases, the quality of the image decreases. The IQR of the quality categories has overlap, but the medians are consistently different in the chart, with the exception of “Good” and “Tiny Problems” which are very similar. The logistic regression also shows that there is overwhelming evidence for this being a useful feature in explaining the quality.</p>
</section>
<section id="extract-na" class="level3">
<h3 class="anchored" data-anchor-id="extract-na">Extract NA</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-6_c522efcbe5f863cee42f028411474159">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(standard.data<span class="sc">$</span>extract_na)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  3.667  12.797  15.082  15.915  18.303  48.454 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(standard.data, <span class="fu">aes</span>(<span class="at">x=</span>Quality, <span class="at">y=</span>extract_na)) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Extract NA by Quality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure shows a box plot with the 5 categorical quality levels on the X axis and the extract na feature on the Y axis. The good scans show a tight clustering around 12 on the Y axis. As the quality of the scan decreases the median increases, and the variance increases slightly as well. The rate of increase is similar to a linear progression. This boxplot shows that higher quality is associated with a lower extract na.</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(Quality <span class="sc">~</span> extract_na,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>standard.data, <span class="at">family=</span><span class="st">"binomial"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Quality ~ extract_na, family = "binomial", data = standard.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.6889   0.1483   0.3688   0.5775   1.9821  

Coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept) -3.09877    0.36353  -8.524   &lt;2e-16 ***
extract_na   0.35060    0.02753  12.736   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1476.4  on 1849  degrees of freedom
Residual deviance: 1226.7  on 1848  degrees of freedom
AIC: 1230.7

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<p>In the boxplot we can see that as Extract NA increases, the quality of the image decreases. The IQR of the quality categories has overlap, but the medians are consistently different in the chart. The logistic regression also shows that there is overwhelming evidence for this being a useful feature in explaining the quality.</p>
</section>
<section id="assess-middle-na-proportion" class="level3">
<h3 class="anchored" data-anchor-id="assess-middle-na-proportion">Assess Middle NA Proportion</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-7_04fc6d5da8e539574daa3aa13e674313">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(standard.data<span class="sc">$</span>assess_middle_na_proportion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
0.0002776 0.0221251 0.0392280 0.0517308 0.0688228 0.3851669 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(standard.data, <span class="fu">aes</span>(<span class="at">x=</span>Quality, <span class="at">y=</span>assess_middle_na_proportion)) <span class="sc">+</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Assess Middle NA Proportion by Quality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure shows a box plot with the 5 categorical quality levels on the X axis and the assess middle NA proportion feature on the Y axis. The good scans show a tight clustering around 0.025 on the Y axis. As the quality of the scan decreases the median increases, and the variance increases as well. The rate of increase is similar to a linear progression. This boxplot shows that higher quality is associated with a lower assess middle NA proportion.</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(Quality <span class="sc">~</span> assess_middle_na_proportion,</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>standard.data, <span class="at">family=</span><span class="st">"binomial"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Quality ~ assess_middle_na_proportion, family = "binomial", 
    data = standard.data)

Deviance Residuals: 
     Min        1Q    Median        3Q       Max  
-2.72629   0.03616   0.24091   0.58568   1.34175  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -0.4164     0.1454  -2.864  0.00419 ** 
assess_middle_na_proportion  73.9873     5.7409  12.888  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1476.4  on 1849  degrees of freedom
Residual deviance: 1115.6  on 1848  degrees of freedom
AIC: 1119.6

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
<p>In the boxplot we can see that as Extract NA increases, the quality of the image decreases. The IQR of the quality categories has overlap, but the medians are consistently different in the chart. The logistic regression also shows that there is overwhelming evidence for this being a useful feature in explaining the quality.</p>
</section>
<section id="assess-rotation" class="level3">
<h3 class="anchored" data-anchor-id="assess-rotation">Assess Rotation</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-8_0d7a7f5bac41f3dc78ce15593b1366d7">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(standard.data<span class="sc">$</span>assess_rotation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.3143  0.6904  1.0279  1.4601  4.9878 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(standard.data, <span class="fu">aes</span>(<span class="at">x=</span>Quality, <span class="at">y=</span>assess_rotation)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Assess Rotation by Quality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure shows a box plot with the 5 categorical quality levels on the X axis and the assess rotation feature on the Y axis. All of the categories have a median located around the 0.75 mark on the Y axis. All of the categories have minor variations on their quantiles, but they are all between 1.75 and 0.25. Each of the categories have large numbers of outliers even beyond the 4 mark. Due to the categories all being very similar, there is no reason to assume that there is an association between quality and the assess rotation feature.</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(Quality <span class="sc">~</span> assess_rotation,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>standard.data, <span class="at">family=</span><span class="st">"binomial"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Quality ~ assess_rotation, family = "binomial", 
    data = standard.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0678   0.5270   0.5443   0.5507   0.5555  

Coefficients:
                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)      1.79066    0.09775  18.319   &lt;2e-16 ***
assess_rotation  0.05131    0.07105   0.722     0.47    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1476.4  on 1849  degrees of freedom
Residual deviance: 1475.9  on 1848  degrees of freedom
AIC: 1479.9

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>In the boxplot, we see that there is no significant visual difference in median or IQR of Assess Rotation when grouped by Quality. The logistic regression shows no evidence that this feature can help explain the quality of an image. This feature was primarily intended for use in predicting a particular problem that occurs in scans.</p>
</section>
<section id="assess-bottomempty" class="level3">
<h3 class="anchored" data-anchor-id="assess-bottomempty">Assess Bottomempty</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-9_7c92c33c8fdf2eeda2cac61dc96701df">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(standard.data<span class="sc">$</span>assess_bottomempty)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  8.516  22.669  27.540  29.903  34.634  95.394 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(standard.data, <span class="fu">aes</span>(<span class="at">x=</span>Quality, <span class="at">y=</span>assess_bottomempty)) <span class="sc">+</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Assess Bottomempty by Quality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure shows a box plot with the 5 categorical quality levels on the X axis and the assess bottom empty feature on the Y axis. The good scans show a median of 24 with quantiles at 20 and 2. As the quality of the scan decreases the median increases, and the variance increases as well. The rate of increase is similar to the start of an exponential chart where the rate of change increases over time, the median of the Yike category is 49m and the variance is from 36 to 69. This boxplot shows that higher quality is associated with a lower assess bottomempty.</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(Quality <span class="sc">~</span> assess_bottomempty,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>standard.data, <span class="at">family=</span><span class="st">"binomial"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Quality ~ assess_bottomempty, family = "binomial", 
    data = standard.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.4871   0.2807   0.4750   0.6070   1.0997  

Coefficients:
                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)        -0.577479   0.258462  -2.234   0.0255 *  
assess_bottomempty  0.089585   0.009999   8.960   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1476.4  on 1849  degrees of freedom
Residual deviance: 1368.4  on 1848  degrees of freedom
AIC: 1372.4

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>In the boxplot we can see that as Assess Bottomempty increases, the quality of the image decreases. The IQR of the quality categories has overlap, but the medians are consistently different in the chart. There is an observation of note that the Yikes category has a particularly large IQR. The logistic regression also shows that there is overwhelming evidence for this being a useful feature in explaining the quality.</p>
</section>
<section id="assess-median-na-proportion" class="level3">
<h3 class="anchored" data-anchor-id="assess-median-na-proportion">Assess Median NA Proportion</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-10_1e01068f931d3e7f2217577402fcca39">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(standard.data<span class="sc">$</span>assess_median_na_proportion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.00000 0.00331 0.01088 0.02073 0.02716 0.25525 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(standard.data, <span class="fu">aes</span>(<span class="at">x=</span>Quality, <span class="at">y=</span>assess_median_na_proportion)) <span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Assess Median NA Proportion by Quality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure shows a box plot with the 5 categorical quality levels on the X axis and the assess median NA proportion feature on the Y axis. The good scans show a tight clustering around 0.0 on the Y axis. As the quality of the scan decreases the median increases, and the variance increases as well. The rate of increase is similar to a linear progression. This boxplot shows that higher quality is associated with a lower assess median NA proportion.</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">glm</span>(Quality <span class="sc">~</span> assess_median_na_proportion,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>standard.data, <span class="at">family=</span><span class="st">"binomial"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Quality ~ assess_median_na_proportion, family = "binomial", 
    data = standard.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.0868   0.0000   0.0104   0.2550   1.4413  

Coefficients:
                            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -0.6017     0.1206  -4.991 6.02e-07 ***
assess_median_na_proportion 585.1354    45.1784  12.952  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1476.42  on 1849  degrees of freedom
Residual deviance:  782.01  on 1848  degrees of freedom
AIC: 786.01

Number of Fisher Scoring iterations: 10</code></pre>
</div>
</div>
<p>In the boxplot we can see that as Assess Median NA Proportion increases, the quality of the image decreases. The IQR of the quality categories has overlap, but the medians are consistently different in the chart. The “Bad” and “Yikes” categories have very similar IQR and Medians. The logistic regression also shows that there is overwhelming evidence, with reservation, for this being a useful feature in explaining the quality.</p>
</section>
<section id="cross-correlations" class="level3">
<h3 class="anchored" data-anchor-id="cross-correlations">Cross Correlations</h3>
<ul>
<li><span style="color: red;">XXX include https://heike.github.io/ggpcp/</span></li>
</ul>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-11_2e3fd57468c7f409a205eeed77e6903c">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span> <span class="fu">cor</span>(full.data[,<span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(correlations, <span class="at">method =</span> <span class="st">"shade"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">This plot shows a color for each combination of features’ correlation. All of the feature pairs have a correlation above 0.5 with the following exceptions. Assess rotation has no meaningful correlation with any other feature. Assess bottomempty and assess percentile na proportion have a correlation of 0.2. Assess bottomempty and assess median na proportion have a correlation of 0.3.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-12_f54d40187c7059916d98cb281bbea667">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(full.data[,<span class="dv">6</span><span class="sc">:</span><span class="dv">12</span>], <span class="at">pch=</span><span class="dv">19</span>, <span class="at">lower.panel=</span><span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">This plot shows a scatter plot of all feature pairs to check for correlation. All of the features, barring assess rotation, show a linear line between the pairs. Many of the feature pairs have trailing outliers either above or below the linear lines.</figcaption>
</figure>
</div>
</div>
</div>
<p>There is significant correlation between most of the variables except assess rotation.</p>
</section>
</section>
<section id="standard-model-analysis" class="level2">
<h2 class="anchored" data-anchor-id="standard-model-analysis">Standard Model Analysis</h2>
<p>XXX Need ROC curves, add AUC to the presented metrics, distribution of the predictions</p>
<table class="table">
<colgroup>
<col style="width: 39%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>TPR</th>
<th>TNR</th>
<th>F1 Score</th>
<th>Kappa</th>
<th>AUC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Stnd Multinomial Logistic Regression</td>
<td><strong>0.9821</strong></td>
<td>0.6786</td>
<td>0.9283</td>
<td>0.7191</td>
<td>0.8304</td>
</tr>
<tr class="even">
<td>Stnd Binary Logistic Regression</td>
<td>0.9643</td>
<td>0.7714</td>
<td>0.9364</td>
<td>0.7677</td>
<td><strong>0.9533</strong></td>
</tr>
<tr class="odd">
<td>Stnd Ordinal Random Forest</td>
<td>0.9643</td>
<td>0.7714</td>
<td>0.9364</td>
<td>0.7677</td>
<td>0.8304</td>
</tr>
<tr class="even">
<td>Stnd Binary Random Forest</td>
<td>0.9286</td>
<td><strong>0.8286</strong></td>
<td>0.9286</td>
<td>0.7571</td>
<td>0.9477</td>
</tr>
</tbody>
</table>
<p>Metric Function that provides our results:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-13_29f19143f88609bae03935e09a4ca725">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function intended to standardize outputs a bit better</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>numerical.Metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(test, modelName) {</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  metrics <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(<span class="fu">round</span>(test<span class="sc">$</span>num.predictions), <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                             test<span class="sc">$</span>num.Quality, <span class="at">mode=</span><span class="st">"everything"</span>, <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(metrics)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Get the AUC</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  metricROC <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>num.Quality <span class="sc">~</span> test<span class="sc">$</span>num.predictions)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  metricAUC <span class="ot">&lt;-</span> <span class="fu">auc</span>(metricROC)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#returns c(modelName, TPR, TNR, F1, Kappa)</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(modelName, <span class="fu">round</span>(metrics<span class="sc">$</span>byClass[<span class="dv">1</span>], <span class="dv">4</span>), <span class="fu">round</span>(metrics<span class="sc">$</span>byClass[<span class="dv">2</span>], <span class="dv">4</span>), </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">round</span>(metrics<span class="sc">$</span>byClass[<span class="dv">7</span>], <span class="dv">4</span>), <span class="fu">round</span>(metrics<span class="sc">$</span>overall[<span class="dv">2</span>], <span class="dv">4</span>), <span class="fu">round</span>(metricAUC, <span class="dv">4</span>)))</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creation of the training and test data.</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-14_9840aaba1e0b89e070c05ef7f1ecda12">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), <span class="fu">nrow</span>(standard.data), <span class="at">replace=</span><span class="cn">TRUE</span>, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.75</span>,<span class="fl">0.25</span>))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>sample <span class="ot">&lt;-</span> sample</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>set <span class="ot">&lt;-</span> <span class="st">"Train"</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>set[full.data<span class="sc">$</span>sample <span class="sc">==</span> <span class="cn">FALSE</span>] <span class="ot">&lt;-</span> <span class="st">"Test"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>set <span class="ot">=</span> <span class="fu">factor</span>(full.data<span class="sc">$</span>set, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"Train"</span>, <span class="st">"Test"</span>))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>followup <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>num.Quality <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>num.Quality[full.data<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Good"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>num.Quality[full.data<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Tiny Problems"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>num.Quality <span class="ot">&lt;-</span> <span class="fu">factor</span>(full.data<span class="sc">$</span>num.Quality, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>train  <span class="ot">&lt;-</span> full.data[sample, ]</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>test   <span class="ot">&lt;-</span> full.data[<span class="sc">!</span>sample, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-15_28e60930d42957979328995ceb0da107">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(full.data) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>Quality, <span class="at">fill=</span>Problem)) <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Overview of samples in the dependent variable in the training and test set. The two barcharts show very similar distributions, and the distribution of problem types within scan quality is also similar. Overall we see the strong imbalance in the frequency of quality categories. By far the most scans have some tiny problems.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-16_3c90df80f8d7b31301deb97af142489a">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(full.data) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>num.Quality, <span class="at">fill=</span>Problem)) <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">A barchart of Quality grouped into binary categories, faceted by Train and Test, and colored by Problem. The majority of the binary Good scans appear to have the Holes problem, and the majority of the binary Bad scans appear to have the Feathering problem. The Train and Test datasets appear to be similarly balanced between Good and Bad scans. There are roughly double the number of Good scans as there are Bad scans.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-17_ea1ccd4c8ebc13807cd1c602fd7864fe">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>model.metrics.all <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">6</span>))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(model.metrics.all) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Model"</span>, <span class="st">"TPR"</span>, <span class="st">"TNR"</span>, <span class="st">"F1"</span>, <span class="st">"Kappa"</span>, <span class="st">"AUC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="standard-multi-nomial-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="standard-multi-nomial-logistic-regression">Standard Multi-Nomial Logistic Regression</h3>
<p>The assumptions of the multinomial logisitic regression are: - Nominal dependent variable: Not met - No multi-colinearity: - Linear relationship: - No outlier or high influence points:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-18_b4f125cb1cfc47b367d3daa50c150145">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>train.mutli <span class="ot">=</span> train</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>train.mutli<span class="sc">$</span>Quality <span class="ot">&lt;-</span> <span class="fu">factor</span>(train.mutli<span class="sc">$</span>Quality, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"Good"</span>, <span class="st">"Tiny Problems"</span>, <span class="st">"Problematic"</span>, <span class="st">"Bad"</span>, <span class="st">"Yikes"</span>), <span class="at">ordered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>train.mutli<span class="sc">$</span>Quality <span class="ot">&lt;-</span> <span class="fu">relevel</span>(train.mutli<span class="sc">$</span>Quality, <span class="at">ref =</span> <span class="st">"Good"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Unordered multinomial model</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>multi.model <span class="ot">&lt;-</span> <span class="fu">multinom</span>(Quality <span class="sc">~</span> assess_percentile_na_proportion <span class="sc">+</span> assess_col_na <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                         extract_na <span class="sc">+</span> assess_middle_na_proportion <span class="sc">+</span> assess_bottomempty <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>                         assess_median_na_proportion, <span class="at">data =</span> train.mutli)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  40 (28 variable)
initial  value 2211.367692 
iter  10 value 1492.051628
iter  20 value 1184.473639
iter  30 value 1076.098008
iter  40 value 1010.892215
iter  50 value 997.593885
iter  60 value 989.880545
iter  70 value 988.354039
iter  80 value 984.631384
iter  90 value 983.791277
iter 100 value 982.668007
final  value 982.668007 
stopped after 100 iterations</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(multi.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
multinom(formula = Quality ~ assess_percentile_na_proportion + 
    assess_col_na + extract_na + assess_middle_na_proportion + 
    assess_bottomempty + assess_median_na_proportion, data = train.mutli)

Coefficients:
              (Intercept) assess_percentile_na_proportion assess_col_na
Tiny Problems   3.0859266                        137.0631      2.765235
Problematic    -0.7128178                        145.3500      5.011016
Bad            -2.9072182                        159.5495      5.392954
Yikes          -8.6268924                        161.5927      7.846236
               extract_na assess_middle_na_proportion assess_bottomempty
Tiny Problems  0.06904753                    159.6285         -0.4114700
Problematic    0.06577464                    203.8588         -0.5032123
Bad            0.07342551                    206.1403         -0.5037006
Yikes         -0.02117973                    192.8034         -0.4524735
              assess_median_na_proportion
Tiny Problems                    137.0631
Problematic                      145.3500
Bad                              159.5495
Yikes                            161.5927

Std. Errors:
              (Intercept) assess_percentile_na_proportion assess_col_na
Tiny Problems   0.6807013                        3.766134      1.007894
Problematic     0.8774300                        2.931461      1.217515
Bad             1.0121794                        2.855052      1.299274
Yikes           1.6181734                        3.439781      1.605986
              extract_na assess_middle_na_proportion assess_bottomempty
Tiny Problems 0.07175698                    6.982568         0.03082904
Problematic   0.08958740                    6.116176         0.03307352
Bad           0.09939011                    7.440296         0.03596081
Yikes         0.16352461                    2.076766         0.04968974
              assess_median_na_proportion
Tiny Problems                    3.766134
Problematic                      2.931461
Bad                              2.855052
Yikes                            3.439781

Residual Deviance: 1965.336 
AIC: 2013.336 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>Predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(multi.model, test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>$$ log() = 3.086 + 137.06X_{APNP} + 2.765X_{ACN} + 0.069X_{EN} + 159.629X_{AMidNP} - 0.411X_{AB} + 137.063X_{AMedNP} \</p>
<p>log() = -0.713 + 145.350X_{APNP} +5.011X_{ACN} + 0.066X_{EN} + 203.859X_{AMidNP} - 0.503X_{AB} + 145.35X_{AMedNP} \</p>
<p>log() = -2.907 + 159.55X_{APNP} + 5.393X_{ACN} + 0.073X_{EN} + 206.140X_{AMidNP} - 0.504X_{AB} + 159.55X_{AMedNP} \</p>
<p>log() = -8.627 + 161.593X_{APNP} + 7.846X_{ACN} - 0.021X_{EN} + 192.803X_{AMidNP} - 0.452X_{AB} + 161.593X_{AMedNP} \</p>
<p>$$</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-19_4a37151e3360454c85176dcb0d6a1086">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>testMetrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predict</span>(multi.model, test, <span class="at">type=</span><span class="st">"probs"</span>))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>testMetrics<span class="sc">$</span>Quality <span class="ot">&lt;-</span> test<span class="sc">$</span>Quality</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>testMetrics<span class="sc">$</span>LAPD_id <span class="ot">&lt;-</span> test<span class="sc">$</span>LAPD_id</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>testMetrics <span class="ot">&lt;-</span> testMetrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span> (</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">isGood =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Good"</span>),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">isTiny =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Tiny Problems"</span>),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">isProb =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Problematic"</span>),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">isBad =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Bad"</span>),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">isYikes =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Yikes"</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>GoodROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isGood <span class="sc">~</span> testMetrics<span class="sc">$</span>Good)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>TinyROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isTiny <span class="sc">~</span> testMetrics<span class="sc">$</span>Tiny.Problems)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>ProbROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isProb <span class="sc">~</span> testMetrics<span class="sc">$</span>Problematic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>BadROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isBad <span class="sc">~</span> testMetrics<span class="sc">$</span>Bad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>YikesROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isYikes <span class="sc">~</span> testMetrics<span class="sc">$</span>Yikes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
</div>
<p>Comparing the ROC curve of the different Qualities.</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-20_8c6ddf8cbc00677830c0a161922f99a6">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(<span class="fu">list</span>(<span class="at">GoodROC =</span> GoodROC, <span class="at">TinyROC =</span> TinyROC, </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">ProbROC =</span> ProbROC, <span class="at">BadROC =</span> BadROC,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">YikesROC =</span> YikesROC))<span class="sc">+</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dotdash"</span>)<span class="sc">+</span></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sensitivity"</span>,</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Specificity"</span>,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Stnd MultiNom Log Good ROC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">A plot of an ROC curve for each of the individual qualities in the standard Multi-nomial model. The Good curve is the closest to the (1,1) mark, followed by Bad, Tiny, followed by Problematic, The yikes curve represents stairs due to its small sample size.</figcaption>
</figure>
</div>
</div>
</div>
<p>To help compare these models, we will introduce a compression concept. Just as before, all scans will be divided into Good, which includes Good and Tiny Problems. Bad will include all other categories.</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-21_a4f425edd2c39ad9233148ad8bba96ae">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions[test<span class="sc">$</span>Predictions <span class="sc">==</span> <span class="st">"Good"</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions[test<span class="sc">$</span>Predictions <span class="sc">==</span> <span class="st">"Tiny Problems"</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>StndMultiLog <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>num.Quality <span class="sc">~</span> test<span class="sc">$</span>num.predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>model.metrics.all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.metrics.all, <span class="fu">numerical.Metrics</span>(test, <span class="st">"Stnd Multi Log Reg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0  95   6
         1  45 330
                                          
               Accuracy : 0.8929          
                 95% CI : (0.8615, 0.9192)
    No Information Rate : 0.7059          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.7191          
                                          
 Mcnemar's Test P-Value : 1.032e-07       
                                          
            Sensitivity : 0.9821          
            Specificity : 0.6786          
         Pos Pred Value : 0.8800          
         Neg Pred Value : 0.9406          
              Precision : 0.8800          
                 Recall : 0.9821          
                     F1 : 0.9283          
             Prevalence : 0.7059          
         Detection Rate : 0.6933          
   Detection Prevalence : 0.7878          
      Balanced Accuracy : 0.8304          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/eval-multinom_2486b2a87680766805ed28a259ee5f6e">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">table</span>(test<span class="sc">$</span>Quality, test<span class="sc">$</span>Predictions)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>dframe <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(dt) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Var1 =</span> <span class="fu">factor</span>(Var1, <span class="at">levels=</span><span class="fu">levels</span>(test<span class="sc">$</span>Quality)),</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Var2 =</span> <span class="fu">factor</span>(Var2, <span class="at">levels=</span><span class="fu">levels</span>(test<span class="sc">$</span>Quality)),</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type=</span> Var1<span class="sc">==</span>Var2</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>dframe <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Freq<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Var1, <span class="at">y =</span> Var2, <span class="at">size=</span><span class="fu">sqrt</span>(Freq))) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> type)) <span class="sc">+</span> </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">2.5</span>, <span class="at">colour =</span> <span class="st">"grey70"</span>) <span class="sc">+</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="fl">2.5</span>, <span class="at">colour=</span><span class="st">"grey70"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Which one is that?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/eval-multinom-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>XXX barcharts of predicted scans Quality for all models</p>
</section>
<section id="standard-binary-regression" class="level3">
<h3 class="anchored" data-anchor-id="standard-binary-regression">Standard Binary regression</h3>
<ul>
<li>(Good/Tiny = 1, Problematic/Bad/Yikes = 0)</li>
</ul>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-22_5f3e9d09f27284b2f2ee0345fbb88b94">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>num.logit.model <span class="ot">&lt;-</span> <span class="fu">glm</span>(num.Quality <span class="sc">~</span> assess_percentile_na_proportion <span class="sc">+</span> assess_col_na <span class="sc">+</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                         extract_na <span class="sc">+</span> assess_middle_na_proportion <span class="sc">+</span> assess_bottomempty <span class="sc">+</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                         assess_median_na_proportion,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>train, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(num.logit.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = num.Quality ~ assess_percentile_na_proportion + 
    assess_col_na + extract_na + assess_middle_na_proportion + 
    assess_bottomempty + assess_median_na_proportion, family = "binomial", 
    data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7411  -0.0980   0.3127   0.4743   4.8218  

Coefficients: (1 not defined because of singularities)
                                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                       3.95133    0.64726   6.105 1.03e-09 ***
assess_percentile_na_proportion -30.38695   10.31097  -2.947 0.003208 ** 
assess_col_na                    -2.20329    0.67563  -3.261 0.001110 ** 
extract_na                       -0.01020    0.05424  -0.188 0.850828    
assess_middle_na_proportion     -49.51457   11.13473  -4.447 8.71e-06 ***
assess_bottomempty                0.10088    0.02898   3.481 0.000499 ***
assess_median_na_proportion            NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1653.89  on 1373  degrees of freedom
Residual deviance:  890.62  on 1368  degrees of freedom
AIC: 902.62

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(num.logit.model, test, <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>StndBinLog <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>num.Quality <span class="sc">~</span> test<span class="sc">$</span>num.predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XXX Figure out followup scans</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>test[test<span class="sc">$</span>num.predictions <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> test<span class="sc">$</span>num.Quality <span class="sc">==</span> <span class="dv">1</span>, ]<span class="sc">$</span>followup <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>test[test<span class="sc">$</span>num.predictions <span class="sc">&gt;</span> <span class="fl">0.75</span> <span class="sc">&amp;</span> test<span class="sc">$</span>num.Quality <span class="sc">==</span> <span class="dv">0</span>, ]<span class="sc">$</span>followup <span class="ot">=</span> <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-23_28bb19d9264abb2643a5b1cded5f13e0">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test, <span class="fu">aes</span>(<span class="at">x=</span>num.Quality, <span class="at">y=</span>num.predictions)) <span class="sc">+</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"True Quality"</span>) <span class="sc">+</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability of good scan"</span>) <span class="sc">+</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Numerical Logistic Prediction Test Data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Box plot that shows probability of good scan faceted by binary true quality. The bad quality has a median at 14% with quantiles 3% and 45%, and tailing up to over 80%. The good category has median 89% with quantiles at 80% and 95%, trailing down to 10%. The graph shows a clear distinction between the two problem types</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-24_b063540071ed2eba299d4a8c8911fb8a">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test, <span class="fu">aes</span>(<span class="at">x=</span>num.Quality, <span class="at">y=</span>num.predictions, <span class="at">color=</span>followup)) <span class="sc">+</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"grey50"</span>, <span class="st">"darkorange"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">This is a scatterplot with predicted quality on the y axis, faceted by true quality. On the bad quality. Majority of good scans are above 85%, and bad scans below 25%. Bad points above 75% prediction are labelled for followup, and good points below 50%.</figcaption>
</figure>
</div>
</div>
</div>
<p>The boxplot shows a general picture of the results of the model. There is a significant number of misclassified scans. Using a typical 0.5 rounding we get the confusion matrix:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-25_69b28460ae82cf96c125e38666cd3f76">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>model.metrics.all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.metrics.all, <span class="fu">numerical.Metrics</span>(test, <span class="st">"Stnd Binary Log Reg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 108  12
         1  32 324
                                         
               Accuracy : 0.9076         
                 95% CI : (0.8779, 0.932)
    No Information Rate : 0.7059         
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16      
                                         
                  Kappa : 0.7677         
                                         
 Mcnemar's Test P-Value : 0.004179       
                                         
            Sensitivity : 0.9643         
            Specificity : 0.7714         
         Pos Pred Value : 0.9101         
         Neg Pred Value : 0.9000         
              Precision : 0.9101         
                 Recall : 0.9643         
                     F1 : 0.9364         
             Prevalence : 0.7059         
         Detection Rate : 0.6807         
   Detection Prevalence : 0.7479         
      Balanced Accuracy : 0.8679         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
</div>
</section>
<section id="standard-ordinal-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="standard-ordinal-random-forest">Standard Ordinal random forest</h3>
<p>XXX is this an ordinal random forest or just a categorical one?</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-26_78e3be216294729a986e1f6a080e731c">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>ord.forest.model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(Quality <span class="sc">~</span> assess_percentile_na_proportion <span class="sc">+</span> assess_col_na <span class="sc">+</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                         extract_na <span class="sc">+</span> assess_middle_na_proportion <span class="sc">+</span> assess_bottomempty <span class="sc">+</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>                         assess_median_na_proportion, <span class="at">data =</span> train,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>Predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(ord.forest.model, test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comparing the ROC of the individual categories</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-27_06ff8b6f330d5b84de6f813c6ce1e9cc">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>testMetrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predict</span>(ord.forest.model, test, <span class="at">type=</span><span class="st">"prob"</span>))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>testMetrics<span class="sc">$</span>Quality <span class="ot">&lt;-</span> test<span class="sc">$</span>Quality</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>testMetrics<span class="sc">$</span>LAPD_id <span class="ot">&lt;-</span> test<span class="sc">$</span>LAPD_id</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>testMetrics <span class="ot">&lt;-</span> testMetrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span> (</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">isGood =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Good"</span>),</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">isTiny =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Tiny Problems"</span>),</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">isProb =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Problematic"</span>),</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">isBad =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Bad"</span>),</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">isYikes =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Yikes"</span>)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>GoodROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isGood <span class="sc">~</span> testMetrics<span class="sc">$</span>Good)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>TinyROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isTiny <span class="sc">~</span> testMetrics<span class="sc">$</span>Tiny.Problems)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>ProbROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isProb <span class="sc">~</span> testMetrics<span class="sc">$</span>Problematic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>BadROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isBad <span class="sc">~</span> testMetrics<span class="sc">$</span>Bad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>YikesROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isYikes <span class="sc">~</span> testMetrics<span class="sc">$</span>Yikes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-28_418a9b50304cefb65af14d488c5182b8">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(<span class="fu">list</span>(<span class="at">GoodROC =</span> GoodROC, <span class="at">TinyROC =</span> TinyROC, </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">ProbROC =</span> ProbROC, <span class="at">BadROC =</span> BadROC,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">YikesROC =</span> YikesROC))<span class="sc">+</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dotdash"</span>)<span class="sc">+</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sensitivity"</span>,</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Specificity"</span>,</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Stnd Ordinal Forest ROC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">A plot of an ROC curve for each of the individual qualities in the standard Multi-nomial model. The Good curve is the closest to the (1,1) mark, followed by Bad, Tiny, followed by Problematic, The yikes curve represents stairs due to its small sample size.</figcaption>
</figure>
</div>
</div>
</div>
<p>To help compare these models, we once again use the previous compression metrics.</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-29_fd83b59ef654f78a81233ee0c0a6abf3">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions[test<span class="sc">$</span>Predictions <span class="sc">==</span> <span class="st">"Good"</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions[test<span class="sc">$</span>Predictions <span class="sc">==</span> <span class="st">"Tiny Problems"</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>StndOrdFor <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>num.Quality <span class="sc">~</span> test<span class="sc">$</span>num.predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>model.metrics.all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.metrics.all, <span class="fu">numerical.Metrics</span>(test, <span class="st">"Stnd Ord Rand For"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 115  20
         1  25 316
                                          
               Accuracy : 0.9055          
                 95% CI : (0.8755, 0.9302)
    No Information Rate : 0.7059          
    P-Value [Acc &gt; NIR] : &lt;2e-16          
                                          
                  Kappa : 0.7699          
                                          
 Mcnemar's Test P-Value : 0.551           
                                          
            Sensitivity : 0.9405          
            Specificity : 0.8214          
         Pos Pred Value : 0.9267          
         Neg Pred Value : 0.8519          
              Precision : 0.9267          
                 Recall : 0.9405          
                     F1 : 0.9335          
             Prevalence : 0.7059          
         Detection Rate : 0.6639          
   Detection Prevalence : 0.7164          
      Balanced Accuracy : 0.8810          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
</div>
</section>
<section id="standard-numerical-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="standard-numerical-random-forest">Standard Numerical Random Forest</h3>
<ul>
<li>(Good/Tiny = 1, Problematic/Bad/Yikes = 0)</li>
<li>(Good = 1, Yikes = 0, drop others)</li>
</ul>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-30_606bd4448e3dd9ccea4672f0d2486e89">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>num.RF.model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(num.Quality <span class="sc">~</span> assess_percentile_na_proportion <span class="sc">+</span> assess_col_na <span class="sc">+</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>                         extract_na <span class="sc">+</span> assess_middle_na_proportion <span class="sc">+</span> assess_bottomempty <span class="sc">+</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>                         assess_median_na_proportion, <span class="at">data =</span> train,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(num.RF.model, test, <span class="at">type=</span><span class="st">"prob"</span>)[,<span class="dv">2</span>]</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>StndNumFor <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>num.Quality <span class="sc">~</span> test<span class="sc">$</span>num.predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>test[test<span class="sc">$</span>num.predictions <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> test<span class="sc">$</span>num.Quality <span class="sc">==</span> <span class="dv">1</span>, ]<span class="sc">$</span>followup <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>test[test<span class="sc">$</span>num.predictions <span class="sc">&gt;</span> <span class="fl">0.75</span> <span class="sc">&amp;</span> test<span class="sc">$</span>num.Quality <span class="sc">==</span> <span class="dv">0</span>, ]<span class="sc">$</span>followup <span class="ot">=</span> <span class="cn">TRUE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-31_e6be81033db09dc4fb0ad3bd5081236c">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test, <span class="fu">aes</span>(<span class="at">x=</span>num.Quality, <span class="at">y=</span>num.predictions)) <span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"True Quality"</span>) <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability of good scan"</span>) <span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Numerical Logistic Prediction Test Data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Box plot that shows probability of good scan faceted by binary true quality. The bad quality has a median at 14% with quantiles 3% and 30%, and tailing up to over 65% with outliers to 100%. The good category has median 95% with quantiles at 87% and 99%, trailing down to 1%. The graph shows a clear distinction between the two problem types</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-32_44c0ce4a8a93b3e771ac069ddf3ce443">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test, <span class="fu">aes</span>(<span class="at">x=</span>num.Quality, <span class="at">y=</span>num.predictions, <span class="at">color=</span>followup)) <span class="sc">+</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"grey50"</span>, <span class="st">"darkorange"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">This is a scatterplot with predicted quality on the y axis, faceted by true quality. On the bad quality. Majority of good scans are above 85%, and bad scans below 25%. Bad points above 75% prediction are labelled for followup, and good points below 50%.</figcaption>
</figure>
</div>
</div>
</div>
<p>The boxplot shows a general picture of the results of the model. There is a significant number of misclassified scans. Using a typical 0.5 rounding we get the confusion matrix:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-33_86e3d5649f271c6334b292e45a8dedbb">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>model.metrics.all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.metrics.all, <span class="fu">numerical.Metrics</span>(test, <span class="st">"Stnd Binary Rand For"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 116  24
         1  24 312
                                          
               Accuracy : 0.8992          
                 95% CI : (0.8685, 0.9247)
    No Information Rate : 0.7059          
    P-Value [Acc &gt; NIR] : &lt;2e-16          
                                          
                  Kappa : 0.7571          
                                          
 Mcnemar's Test P-Value : 1               
                                          
            Sensitivity : 0.9286          
            Specificity : 0.8286          
         Pos Pred Value : 0.9286          
         Neg Pred Value : 0.8286          
              Precision : 0.9286          
                 Recall : 0.9286          
                     F1 : 0.9286          
             Prevalence : 0.7059          
         Detection Rate : 0.6555          
   Detection Prevalence : 0.7059          
      Balanced Accuracy : 0.8786          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
</div>
</section>
<section id="standard-model-results" class="level3">
<h3 class="anchored" data-anchor-id="standard-model-results">Standard Model Results</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-35_f187972c44be8e6698c74e12e856d320">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(<span class="fu">list</span>(<span class="at">StndMultiLog =</span> StndMultiLog, <span class="at">StndBinLog =</span> StndBinLog,</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">StndNumFor =</span> StndNumFor, <span class="at">StndOrdFor =</span> StndOrdFor))<span class="sc">+</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sensitivity"</span>,</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Specificity"</span>,</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Comparison of Standard Quality Prediction Models"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Plot shows the four standard models ROC curves on the same plot. the numerical forest and binary logistic regression models show the best curve, curving through the 87.5 point on specificity and sensitivity. The multinomial logistic regression and the ordinal forest both represent a triangle as they had binary conversions to be plotted. Their plots fit inside the other two’s curves.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="cropped-feature-analysis" class="level2">
<h2 class="anchored" data-anchor-id="cropped-feature-analysis">Cropped Feature Analysis</h2>
<section id="hypothesis" class="level4">
<h4 class="anchored" data-anchor-id="hypothesis">Hypothesis</h4>
<p>The quality of our images predicted by the models and assessed by our algorithms is dependent on the how much of the data from the scan is legible and useful. The bottom middle of the bullet gives us the most information, due to the striations in this area being most prominent. Some scans get distorted due to numerous external factors ranging from a bad scan to the bullet undergoing damages that’s affected those striations. Cropping our scans to cut off parts of the scan that are non-essential could help to eliminate the ‘noise’ around the images that skew the accuracy of the results. The goal is to see whether making a crop will improve the accuracy of our models.</p>
</section>
<section id="process" class="level4">
<h4 class="anchored" data-anchor-id="process">Process</h4>
<p>To conduct our analysis, we did a series of tests to compare the cropped version of a scan against the full version. We constructed scatter and box plots as well as ROC curves for visual analysis. We trained a Generalized Linear Model (glm) to test the p values, or importance, of each variable in explaining the quality, and constructed kernel density graphs to compare the scans. Every cropped scan and its full scan counterpart were found to have more than 90% correlation with each other, requiring us to use only one of them for each feature to avoid co-linearity issues.</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-36_611f83360187719ccbd6563093e312a2">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 10%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Correlation</th>
<th style="text-align: left;">pvalue_Full</th>
<th style="text-align: left;">pvalue_cropped</th>
<th style="text-align: left;">auc_Full</th>
<th style="text-align: left;">auc_Cropped</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Extract NA</td>
<td style="text-align: left;">0.908</td>
<td style="text-align: left;">0.229</td>
<td style="text-align: left;">&lt;2e-16</td>
<td style="text-align: left;">0.871</td>
<td style="text-align: left;">0.902</td>
</tr>
<tr class="even">
<td style="text-align: left;">Assess Bottomempty</td>
<td style="text-align: left;">0.905</td>
<td style="text-align: left;">5.86e-10</td>
<td style="text-align: left;">&lt;2e-16</td>
<td style="text-align: left;">0.783</td>
<td style="text-align: left;">0.859</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Assess Col NA</td>
<td style="text-align: left;">0.919</td>
<td style="text-align: left;">1.62e-06</td>
<td style="text-align: left;">1.17e-14</td>
<td style="text-align: left;">0.888</td>
<td style="text-align: left;">0.896</td>
</tr>
<tr class="even">
<td style="text-align: left;">Assess Median NA Proportion</td>
<td style="text-align: left;">0.908</td>
<td style="text-align: left;">&lt;2e-16</td>
<td style="text-align: left;">6.77e-10</td>
<td style="text-align: left;">0.907</td>
<td style="text-align: left;">0.863</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="extract-na-cropped" class="level3">
<h3 class="anchored" data-anchor-id="extract-na-cropped">Extract NA Cropped</h3>
<section id="which-of-the-features-is-better-for-discriminating-between-good-and-bad-scans" class="level4">
<h4 class="anchored" data-anchor-id="which-of-the-features-is-better-for-discriminating-between-good-and-bad-scans">Which of the features is better for discriminating between good and bad scans?</h4>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-37_0b0c838bc44c2fa905e248bbf9b91411">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.
ℹ The deprecated feature was likely used in the yardstick package.
  Please report the issue at &lt;https://github.com/tidymodels/yardstick/issues&gt;.</code></pre>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-38_278fe67d642bd5ea4257564a3e2123e7">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>scatterplot <span class="sc">+</span> <span class="fu">coord_equal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Plot shows a scatterplot of the extract na feature ran on the full scan on the x axis and ran on the cropped scan on the y axis, faceted by quality. The good scans show a clear distinction from the others by being on the bottom left cortner of the graph. The tiny problems, problematic, and bad scans all are disperesed in a linear line. The yikes category is only at the higher end of the points. This graph shows that the feature ran across the cropped scans on average are lower than on the full scan.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-39_789dc0ed57c5b6c7b4118cb3a8e5c555">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>boxplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Plot shows a boxplot of the extract na feature ran on the full scan on the x axis and ran on the cropped scan on the y axis, faceted by quality. The medians of both the cropped and full scans show a linear increase as the quality of the scan degrades. The cropped medians are also all 10 higher or more than the full scans.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-40_261466d17eb1a4b875f2298df252d88f">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>res<span class="sc">$</span>roc_curve</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-41_fb24a233d4d20be9c9b6d5b75115a3af">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Extract NA. Correlation: "</span>, <span class="fu">round</span>(correlation, <span class="dv">3</span>), <span class="st">"Full AUC:"</span>, <span class="fu">round</span>(res<span class="sc">$</span>roc_auc<span class="sc">$</span>Full_AUC, <span class="dv">3</span>), <span class="st">"Cropped AUC: "</span>, <span class="fu">round</span>(res<span class="sc">$</span>roc_auc<span class="sc">$</span>Cropped_AUC, <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Extract NA. Correlation:  0.908 Full AUC: 0.871 Cropped AUC:  0.902"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(res<span class="sc">$</span>summ, <span class="at">caption=</span><span class="fu">attr</span>(res<span class="sc">$</span>summ, <span class="st">"title"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Summary Info of Extract NA</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">firstQ</th>
<th style="text-align: right;">med</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">thirdQ</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Standard</td>
<td style="text-align: right;">3.666645</td>
<td style="text-align: right;">12.79727</td>
<td style="text-align: right;">15.082281</td>
<td style="text-align: right;">15.915471</td>
<td style="text-align: right;">18.30296</td>
<td style="text-align: right;">48.45372</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cropped</td>
<td style="text-align: right;">1.389464</td>
<td style="text-align: right;">6.38338</td>
<td style="text-align: right;">8.060005</td>
<td style="text-align: right;">8.916349</td>
<td style="text-align: right;">10.57698</td>
<td style="text-align: right;">40.80471</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="should-we-use-features-from-just-one-type-of-scan-or-both" class="level4">
<h4 class="anchored" data-anchor-id="should-we-use-features-from-just-one-type-of-scan-or-both">Should we use features from just one type of scan or both?</h4>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-42_51744a55155ac15edbee359fb542903f">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = GoodScan ~ extract_na + extract_na_cropped, family = binomial(), 
    data = full.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.1882  -0.2394   0.3044   0.5298   4.0795  

Coefficients:
                   Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)         7.16247    0.37858  18.919   &lt;2e-16 ***
extract_na         -0.04349    0.03613  -1.204    0.229    
extract_na_cropped -0.58303    0.05020 -11.615   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2230.6  on 1849  degrees of freedom
Residual deviance: 1299.2  on 1847  degrees of freedom
AIC: 1305.2

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion-for-extract-na" class="level4">
<h4 class="anchored" data-anchor-id="conclusion-for-extract-na">Conclusion for Extract NA</h4>
<p>The values for feature <code>extract_NA</code> are highly correlated between the cropped and the full scan.</p>
<p>Using good and scans with only tiny problems as overall ‘good’ scans, the feature applied to cropped scans has an increased accuracy compared to the feature values from the full scan.</p>
<p>We might want to follow up on the orange colored scans:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-43_79bd665ba3bfee30ffac0de45188b084">
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-44_cecc34a8095e1b83a580a102c550cb60">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>LAPD_id[full.data<span class="sc">$</span>followup]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "FAU263-BA-L4" "FAU263-BC-L1" "FAU263-BC-L3" "FAU287-BC-L5" "FAU154-BD-L2"
[6] "FAU277-BA-L4" "FAU286-BA-L5"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>followupScans <span class="ot">&lt;-</span> <span class="fu">rbind</span>(followupScans, full.data[full.data<span class="sc">$</span>followup <span class="sc">==</span> <span class="cn">TRUE</span>,])</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co"># All followups for extract_na are mislabelled scans. They are all labelled as tiny problems but should be problematic or worse.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="assess-bottomempty-cropped" class="level3">
<h3 class="anchored" data-anchor-id="assess-bottomempty-cropped">Assess Bottomempty Cropped</h3>
<section id="which-of-the-features-is-better-for-discriminating-between-good-and-bad-scans-1" class="level4">
<h4 class="anchored" data-anchor-id="which-of-the-features-is-better-for-discriminating-between-good-and-bad-scans-1">Which of the features is better for discriminating between good and bad scans?</h4>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-46_2832e7dc4bddf26600b496959a19ee03">
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-46-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-46-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Assess Bottomempty. Correlation:  0.905 Full AUC: 0.783 Cropped AUC:  0.859"</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Summary Info of Assess Bottomempty</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">firstQ</th>
<th style="text-align: right;">med</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">thirdQ</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Standard</td>
<td style="text-align: right;">8.516493</td>
<td style="text-align: right;">22.66947</td>
<td style="text-align: right;">27.54019</td>
<td style="text-align: right;">29.90259</td>
<td style="text-align: right;">34.63373</td>
<td style="text-align: right;">95.39375</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cropped</td>
<td style="text-align: right;">3.564558</td>
<td style="text-align: right;">10.78581</td>
<td style="text-align: right;">13.54205</td>
<td style="text-align: right;">15.28335</td>
<td style="text-align: right;">17.71191</td>
<td style="text-align: right;">84.22476</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="should-we-use-features-from-just-one-type-of-scan-or-both-1" class="level4">
<h4 class="anchored" data-anchor-id="should-we-use-features-from-just-one-type-of-scan-or-both-1">Should we use features from just one type of scan or both?</h4>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-47_7794de2e1c324331daac700c680d7e54">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = GoodScan ~ assess_bottomempty + assess_bottomempty_cropped, 
    family = binomial(), data = full.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.6794  -0.2813   0.4084   0.6028   4.0680  

Coefficients:
                           Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                 4.57647    0.25156  18.193  &lt; 2e-16 ***
assess_bottomempty          0.09046    0.01460   6.194 5.86e-10 ***
assess_bottomempty_cropped -0.40779    0.02738 -14.895  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2230.6  on 1849  degrees of freedom
Residual deviance: 1503.7  on 1847  degrees of freedom
AIC: 1509.7

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion-for-assess-bottomempty" class="level4">
<h4 class="anchored" data-anchor-id="conclusion-for-assess-bottomempty">Conclusion for Assess Bottomempty</h4>
<p>The values for feature <code>assess_bottomempty</code> are highly correlated between the cropped and the full scan.</p>
<p>Using good and scans with only tiny problems as overall ‘good’ scans, the feature applied to cropped scans has an increased accuracy compared to the feature values from the full scan.</p>
<p>We might want to follow up on the orange colored scans:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-48_5b3cec60527f940e880dbf3d53c27665">
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-49_e05896ff7de871be283c8c2de57dac5a">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>LAPD_id[full.data<span class="sc">$</span>followup]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "FAU263-BC-L3" "FAU154-BD-L2" "FAU204-BC-L4"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>followupScans <span class="ot">&lt;-</span> <span class="fu">rbind</span>(followupScans, full.data[full.data<span class="sc">$</span>followup <span class="sc">==</span> <span class="cn">TRUE</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="assess-col-na-cropped" class="level3">
<h3 class="anchored" data-anchor-id="assess-col-na-cropped">Assess Col NA Cropped</h3>
<section id="which-of-the-features-is-better-for-discriminating-between-good-and-bad-scans-2" class="level4">
<h4 class="anchored" data-anchor-id="which-of-the-features-is-better-for-discriminating-between-good-and-bad-scans-2">Which of the features is better for discriminating between good and bad scans?</h4>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-51_c46427926db83d9886e2861259b0fa0e">
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-51-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-51-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Assess Col NA Correlation:  0.919 Full AUC: 0.888 Cropped AUC:  0.896"</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Summary Info of Assess Col NA</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">firstQ</th>
<th style="text-align: right;">med</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">thirdQ</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Standard</td>
<td style="text-align: right;">0.2573318</td>
<td style="text-align: right;">0.9244176</td>
<td style="text-align: right;">1.0755102</td>
<td style="text-align: right;">1.1654392</td>
<td style="text-align: right;">1.292844</td>
<td style="text-align: right;">4.368436</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cropped</td>
<td style="text-align: right;">0.0920783</td>
<td style="text-align: right;">0.4700281</td>
<td style="text-align: right;">0.6126759</td>
<td style="text-align: right;">0.6851693</td>
<td style="text-align: right;">0.807577</td>
<td style="text-align: right;">3.356120</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="should-we-use-features-from-just-one-type-of-scan-or-both-2" class="level4">
<h4 class="anchored" data-anchor-id="should-we-use-features-from-just-one-type-of-scan-or-both-2">Should we use features from just one type of scan or both?</h4>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-52_745145b4833d61dbc0665d168ea32ee8">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = GoodScan ~ assess_col_na + assess_col_na_cropped, 
    family = binomial(), data = full.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-3.2254  -0.1897   0.3176   0.5365   3.6049  

Coefficients:
                      Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)             7.3581     0.3785  19.440  &lt; 2e-16 ***
assess_col_na          -2.4724     0.5155  -4.796 1.62e-06 ***
assess_col_na_cropped  -4.8233     0.6249  -7.719 1.17e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2230.6  on 1849  degrees of freedom
Residual deviance: 1308.8  on 1847  degrees of freedom
AIC: 1314.8

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion-for-assess-col-na" class="level4">
<h4 class="anchored" data-anchor-id="conclusion-for-assess-col-na">Conclusion for Assess Col NA</h4>
<p>The values for feature <code>assess_col_na</code> are highly correlated between the cropped and the full scan.</p>
<p>Using good and scans with only tiny problems as overall ‘good’ scans, the feature applied to cropped scans has an increased accuracy compared to the feature values from the full scan.</p>
<p>We might want to follow up on the orange colored scans:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-53_299c379e660997bde0ad8f8ae2d20e98">
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-54_7d5eaf36af924e370618dbe3b60e6077">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>LAPD_id[full.data<span class="sc">$</span>followup]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "FAU263-BA-L4" "FAU263-BB-L3" "FAU263-BC-L1" "FAU263-BC-L3" "FAU154-BD-L2"
[6] "FAU286-BA-L5"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>followupScans <span class="ot">&lt;-</span> <span class="fu">rbind</span>(followupScans, full.data[full.data<span class="sc">$</span>followup <span class="sc">==</span> <span class="cn">TRUE</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="assess-median-na-proportion-cropped" class="level3">
<h3 class="anchored" data-anchor-id="assess-median-na-proportion-cropped">Assess Median NA Proportion Cropped</h3>
<section id="which-of-the-features-is-better-for-discriminating-between-good-and-bad-scans-3" class="level4">
<h4 class="anchored" data-anchor-id="which-of-the-features-is-better-for-discriminating-between-good-and-bad-scans-3">Which of the features is better for discriminating between good and bad scans?</h4>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-56_31baaf7fe95c1236deb68947fd35393d">
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-56-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-56-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Assess Median NA Proportion. Correlation:  0.908 Full AUC: 0.907 Cropped AUC:  0.863"</code></pre>
</div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Summary Info of Assess median NA proportion</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">firstQ</th>
<th style="text-align: right;">med</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">thirdQ</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Standard</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0033099</td>
<td style="text-align: right;">0.0108771</td>
<td style="text-align: right;">0.0207348</td>
<td style="text-align: right;">0.0271577</td>
<td style="text-align: right;">0.2552491</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cropped</td>
<td style="text-align: right;">0.0011692</td>
<td style="text-align: right;">0.0518201</td>
<td style="text-align: right;">0.0686747</td>
<td style="text-align: right;">0.0751096</td>
<td style="text-align: right;">0.0918769</td>
<td style="text-align: right;">0.2994505</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="should-we-use-features-from-just-one-type-of-scan-or-both-3" class="level4">
<h4 class="anchored" data-anchor-id="should-we-use-features-from-just-one-type-of-scan-or-both-3">Should we use features from just one type of scan or both?</h4>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-57_be5bc2677674c632c570df0ff2451be8">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = GoodScan ~ assess_median_na_proportion + assess_median_na_proportion_cropped, 
    family = binomial(), data = full.data)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.8226  -0.1079   0.3143   0.4865   5.2612  

Coefficients:
                                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                            4.384      0.257  17.060  &lt; 2e-16 ***
assess_median_na_proportion          -83.035      5.925 -14.014  &lt; 2e-16 ***
assess_median_na_proportion_cropped  -21.546      3.491  -6.171 6.77e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 2230.6  on 1849  degrees of freedom
Residual deviance: 1219.0  on 1847  degrees of freedom
AIC: 1225

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="conclusion-for-assess-median-na-proportion" class="level4">
<h4 class="anchored" data-anchor-id="conclusion-for-assess-median-na-proportion">Conclusion for Assess Median NA Proportion</h4>
<p>The values for feature <code>extract_NA</code> are highly correlated between the cropped and the full scan.</p>
<p>Using good and scans with only tiny problems as overall ‘good’ scans, the feature applied to full scans has an increased accuracy compared to the feature values from the cropped scan.</p>
<p>We might want to follow up on the orange colored scans:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-58_b9ea3a8fcd22822ece3248eb9f06ea0b">
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-59_a7bd5ceb8d5b139d8f9732e639651baf">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>full.data<span class="sc">$</span>LAPD_id[full.data<span class="sc">$</span>followup]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "FAU263-BC-L3" "FAU154-BD-L2" "FAU204-BC-L4"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>followupScans <span class="ot">&lt;-</span> <span class="fu">rbind</span>(followupScans, full.data[full.data<span class="sc">$</span>followup <span class="sc">==</span> <span class="cn">TRUE</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="cropped-model-analysis" class="level2">
<h2 class="anchored" data-anchor-id="cropped-model-analysis">Cropped Model Analysis</h2>
<table class="table">
<colgroup>
<col style="width: 39%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th>Model</th>
<th>TPR</th>
<th>TNR</th>
<th>F1 Score</th>
<th>Kappa</th>
<th>AUC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Crop Multinomial Logistic Regression</td>
<td><strong>0.9821</strong></td>
<td>0.7</td>
<td>0.9322</td>
<td>0.7375</td>
<td>0.8411</td>
</tr>
<tr class="even">
<td>Crop Binary Logistic Regression</td>
<td>0.9554</td>
<td>0.7929</td>
<td>0.9359</td>
<td>0.7707</td>
<td>0.9514</td>
</tr>
<tr class="odd">
<td>Crop Ordinal Random Forest</td>
<td>0.9554</td>
<td>0.8</td>
<td><strong>0.9372</strong></td>
<td><strong>0.7764</strong></td>
<td>0.8777</td>
</tr>
<tr class="even">
<td>Crop Binary Random Forest</td>
<td>0.9375</td>
<td><strong>0.8286</strong></td>
<td>0.9333</td>
<td>0.7709</td>
<td>0.9503</td>
</tr>
</tbody>
</table>
<section id="cropped-multi-nomial-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="cropped-multi-nomial-logistic-regression">Cropped Multi-Nomial Logistic Regression</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-61_18a8e45084d67a1c69a4cc15f2de4934">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>train.mutli <span class="ot">=</span> train</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>train.mutli<span class="sc">$</span>Quality <span class="ot">&lt;-</span> <span class="fu">factor</span>(train.mutli<span class="sc">$</span>Quality, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"Good"</span>, <span class="st">"Tiny Problems"</span>, <span class="st">"Problematic"</span>, <span class="st">"Bad"</span>, <span class="st">"Yikes"</span>), <span class="at">ordered =</span> <span class="cn">FALSE</span>)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>train.mutli<span class="sc">$</span>Quality <span class="ot">&lt;-</span> <span class="fu">relevel</span>(train.mutli<span class="sc">$</span>Quality, <span class="at">ref =</span> <span class="st">"Good"</span>)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>crop.multi.model <span class="ot">&lt;-</span> <span class="fu">multinom</span>(Quality <span class="sc">~</span> assess_percentile_na_proportion <span class="sc">+</span> assess_col_na_cropped <span class="sc">+</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>                         extract_na_cropped <span class="sc">+</span> assess_middle_na_proportion <span class="sc">+</span> assess_bottomempty_cropped <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>                         assess_median_na_proportion, <span class="at">data =</span> train.mutli)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  40 (28 variable)
initial  value 2211.367692 
iter  10 value 1582.624274
iter  20 value 1150.501505
iter  30 value 1094.363546
iter  40 value 1044.013798
iter  50 value 1031.532663
iter  60 value 1017.238954
iter  70 value 1016.003542
iter  80 value 1008.914089
iter  90 value 1000.983993
iter 100 value 999.206560
final  value 999.206560 
stopped after 100 iterations</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(crop.multi.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
multinom(formula = Quality ~ assess_percentile_na_proportion + 
    assess_col_na_cropped + extract_na_cropped + assess_middle_na_proportion + 
    assess_bottomempty_cropped + assess_median_na_proportion, 
    data = train.mutli)

Coefficients:
              (Intercept) assess_percentile_na_proportion assess_col_na_cropped
Tiny Problems  -0.2150248                        161.7733              3.040890
Problematic    -4.8308529                        174.5753              5.607407
Bad            -7.2802618                        193.6405              3.676780
Yikes         -11.1700219                        193.0131              5.635312
              extract_na_cropped assess_middle_na_proportion
Tiny Problems        0.087877349                    39.49396
Problematic          0.173669012                    61.21251
Bad                  0.291570126                    53.28277
Yikes                0.005283965                    67.90444
              assess_bottomempty_cropped assess_median_na_proportion
Tiny Problems                 -0.2474956                    161.7733
Problematic                   -0.3102062                    174.5753
Bad                           -0.2207637                    193.6405
Yikes                         -0.1617886                    193.0131

Std. Errors:
              (Intercept) assess_percentile_na_proportion assess_col_na_cropped
Tiny Problems   0.4162754                        3.284634              1.160127
Problematic     0.5612130                        2.743781              1.379280
Bad             0.6536302                        2.532788              1.463358
Yikes           1.1179200                        4.681536              1.930695
              extract_na_cropped assess_middle_na_proportion
Tiny Problems          0.0858306                    8.080632
Problematic            0.1094941                    8.762698
Bad                    0.1228167                    8.820897
Yikes                  0.2014354                    9.592386
              assess_bottomempty_cropped assess_median_na_proportion
Tiny Problems                 0.05407378                    3.284634
Problematic                   0.05893741                    2.743781
Bad                           0.05927771                    2.532788
Yikes                         0.06442291                    4.681536

Residual Deviance: 1998.413 
AIC: 2046.413 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>Predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(crop.multi.model, test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comparing the ROC of the individual categories</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-62_cdb3369da441e0c535fe003944ff1e2e">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>testMetrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predict</span>(crop.multi.model, test, <span class="at">type=</span><span class="st">"probs"</span>))</span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>testMetrics<span class="sc">$</span>Quality <span class="ot">&lt;-</span> test<span class="sc">$</span>Quality</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>testMetrics<span class="sc">$</span>LAPD_id <span class="ot">&lt;-</span> test<span class="sc">$</span>LAPD_id</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>testMetrics <span class="ot">&lt;-</span> testMetrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span> (</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">isGood =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Good"</span>),</span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">isTiny =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Tiny Problems"</span>),</span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">isProb =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Problematic"</span>),</span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">isBad =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Bad"</span>),</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">isYikes =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Yikes"</span>)</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>GoodROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isGood <span class="sc">~</span> testMetrics<span class="sc">$</span>Good)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>TinyROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isTiny <span class="sc">~</span> testMetrics<span class="sc">$</span>Tiny.Problems)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>ProbROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isProb <span class="sc">~</span> testMetrics<span class="sc">$</span>Problematic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>BadROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isBad <span class="sc">~</span> testMetrics<span class="sc">$</span>Bad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>YikesROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isYikes <span class="sc">~</span> testMetrics<span class="sc">$</span>Yikes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(<span class="fu">list</span>(<span class="at">GoodROC =</span> GoodROC, <span class="at">YinyROC =</span> TinyROC, </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">ProbROC =</span> ProbROC, <span class="at">BadROC =</span> BadROC,</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">YikesROC =</span> YikesROC))<span class="sc">+</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dotdash"</span>)<span class="sc">+</span></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sensitivity"</span>,</span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Specificity"</span>,</span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Crpped Multi Log ROC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-63_35d5d1f4863b52c4e7b3d91966b710c2">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions[test<span class="sc">$</span>Predictions <span class="sc">==</span> <span class="st">"Good"</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions[test<span class="sc">$</span>Predictions <span class="sc">==</span> <span class="st">"Tiny Problems"</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>CrpMultiLog <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>num.Quality <span class="sc">~</span> test<span class="sc">$</span>num.predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>model.metrics.all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.metrics.all, <span class="fu">numerical.Metrics</span>(test, <span class="st">"Crop Multi Logistic Reg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0  98   6
         1  42 330
                                          
               Accuracy : 0.8992          
                 95% CI : (0.8685, 0.9247)
    No Information Rate : 0.7059          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.7375          
                                          
 Mcnemar's Test P-Value : 4.376e-07       
                                          
            Sensitivity : 0.9821          
            Specificity : 0.7000          
         Pos Pred Value : 0.8871          
         Neg Pred Value : 0.9423          
              Precision : 0.8871          
                 Recall : 0.9821          
                     F1 : 0.9322          
             Prevalence : 0.7059          
         Detection Rate : 0.6933          
   Detection Prevalence : 0.7815          
      Balanced Accuracy : 0.8411          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
</div>
</section>
<section id="cropped-binary-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="cropped-binary-logistic-regression">Cropped Binary Logistic Regression</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-64_454d17f7e0e31609d7cdb65514c0d606">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>crop.num.logit.model <span class="ot">&lt;-</span> <span class="fu">glm</span>(num.Quality <span class="sc">~</span> assess_percentile_na_proportion <span class="sc">+</span> assess_col_na_cropped <span class="sc">+</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>                         extract_na_cropped <span class="sc">+</span> assess_middle_na_proportion <span class="sc">+</span> assess_bottomempty_cropped <span class="sc">+</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>                         assess_median_na_proportion,</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data=</span>train, <span class="at">family=</span><span class="st">"binomial"</span>)</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(crop.num.logit.model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = num.Quality ~ assess_percentile_na_proportion + 
    assess_col_na_cropped + extract_na_cropped + assess_middle_na_proportion + 
    assess_bottomempty_cropped + assess_median_na_proportion, 
    family = "binomial", data = train)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.8606  -0.1038   0.3037   0.4752   4.7557  

Coefficients: (1 not defined because of singularities)
                                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                       5.15597    0.40023  12.882  &lt; 2e-16 ***
assess_percentile_na_proportion -48.51232    8.10027  -5.989 2.11e-09 ***
assess_col_na_cropped            -1.89400    0.76173  -2.486   0.0129 *  
extract_na_cropped               -0.12818    0.06975  -1.838   0.0661 .  
assess_middle_na_proportion     -15.42333    7.40409  -2.083   0.0372 *  
assess_bottomempty_cropped        0.01174    0.03608   0.325   0.7448    
assess_median_na_proportion            NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1653.89  on 1373  degrees of freedom
Residual deviance:  891.41  on 1368  degrees of freedom
AIC: 903.41

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(crop.num.logit.model, test, <span class="at">type=</span><span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :
prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>CrpBinLog <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>num.Quality <span class="sc">~</span> test<span class="sc">$</span>num.predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># XXX Figure out followup scans</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>test[test<span class="sc">$</span>num.predictions <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> test<span class="sc">$</span>num.Quality <span class="sc">==</span> <span class="dv">1</span>, ]<span class="sc">$</span>followup <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>test[test<span class="sc">$</span>num.predictions <span class="sc">&gt;</span> <span class="fl">0.75</span> <span class="sc">&amp;</span> test<span class="sc">$</span>num.Quality <span class="sc">==</span> <span class="dv">0</span>, ]<span class="sc">$</span>followup <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test, <span class="fu">aes</span>(<span class="at">x=</span>num.Quality, <span class="at">y=</span>num.predictions)) <span class="sc">+</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"True Quality"</span>) <span class="sc">+</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability of good scan"</span>) <span class="sc">+</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Cropped Binary Logistic Prediction Test Data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test, <span class="fu">aes</span>(<span class="at">x=</span>num.Quality, <span class="at">y=</span>num.predictions, <span class="at">color=</span>followup)) <span class="sc">+</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"grey50"</span>, <span class="st">"darkorange"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-64-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The boxplot shows a general picture of the results of the model. There is a significant number of misclassified scans. Using a typical 0.5 rounding we get the confusion matrix:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-65_e62e6f1957b6378c4b90eb0793b1eea7">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>model.metrics.all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.metrics.all, <span class="fu">numerical.Metrics</span>(test, <span class="st">"Crop Binary Logistic Reg"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 111  15
         1  29 321
                                         
               Accuracy : 0.9076         
                 95% CI : (0.8779, 0.932)
    No Information Rate : 0.7059         
    P-Value [Acc &gt; NIR] : &lt; 2e-16        
                                         
                  Kappa : 0.7707         
                                         
 Mcnemar's Test P-Value : 0.05002        
                                         
            Sensitivity : 0.9554         
            Specificity : 0.7929         
         Pos Pred Value : 0.9171         
         Neg Pred Value : 0.8810         
              Precision : 0.9171         
                 Recall : 0.9554         
                     F1 : 0.9359         
             Prevalence : 0.7059         
         Detection Rate : 0.6744         
   Detection Prevalence : 0.7353         
      Balanced Accuracy : 0.8741         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
</div>
</section>
<section id="cropped-ordinal-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="cropped-ordinal-random-forest">Cropped Ordinal Random Forest</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-66_9b44cdf39686f4a7379bdf79c4df86cc">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>crop.ord.forest.model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(Quality <span class="sc">~</span> assess_percentile_na_proportion <span class="sc">+</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>                                      assess_col_na_cropped <span class="sc">+</span> extract_na_cropped <span class="sc">+</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>                                      assess_middle_na_proportion <span class="sc">+</span> assess_bottomempty_cropped <span class="sc">+</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>                                      assess_median_na_proportion, <span class="at">data =</span> train,</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>Predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(crop.ord.forest.model, test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Comparing the ROC of the individual categories</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-67_09634e15d17a0379b2c4be556bbe2c50">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>testMetrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predict</span>(crop.ord.forest.model, test, <span class="at">type=</span><span class="st">"prob"</span>))</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>testMetrics<span class="sc">$</span>Quality <span class="ot">&lt;-</span> test<span class="sc">$</span>Quality</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>testMetrics<span class="sc">$</span>LAPD_id <span class="ot">&lt;-</span> test<span class="sc">$</span>LAPD_id</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>testMetrics <span class="ot">&lt;-</span> testMetrics <span class="sc">%&gt;%</span> <span class="fu">mutate</span> (</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">isGood =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Good"</span>),</span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">isTiny =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Tiny Problems"</span>),</span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">isProb =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Problematic"</span>),</span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">isBad =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Bad"</span>),</span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">isYikes =</span> (testMetrics<span class="sc">$</span>Quality <span class="sc">==</span> <span class="st">"Yikes"</span>)</span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a>GoodROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isGood <span class="sc">~</span> testMetrics<span class="sc">$</span>Good)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>TinyROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isTiny <span class="sc">~</span> testMetrics<span class="sc">$</span>Tiny.Problems)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>ProbROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isProb <span class="sc">~</span> testMetrics<span class="sc">$</span>Problematic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>BadROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isBad <span class="sc">~</span> testMetrics<span class="sc">$</span>Bad)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>YikesROC<span class="ot">&lt;-</span> <span class="fu">roc</span>(testMetrics<span class="sc">$</span>isYikes <span class="sc">~</span> testMetrics<span class="sc">$</span>Yikes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = FALSE, case = TRUE
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(<span class="fu">list</span>(<span class="at">GoodROC =</span> GoodROC, <span class="at">YinyROC =</span> TinyROC, </span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">ProbROC =</span> ProbROC, <span class="at">BadROC =</span> BadROC,</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">YikesROC =</span> YikesROC))<span class="sc">+</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">0</span>),</span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dotdash"</span>)<span class="sc">+</span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sensitivity"</span>,</span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Specificity"</span>,</span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Crpped Ordinal Forest ROC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>To help compare these models, we will introduce a compression concept. Just as before, all scans will be divided into Good, which includes Good and Tiny Problems. Bad will include all other categories.</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-68_c7d9ab55ce13140d3d81de30593b5bad">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions[test<span class="sc">$</span>Predictions <span class="sc">==</span> <span class="st">"Good"</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions[test<span class="sc">$</span>Predictions <span class="sc">==</span> <span class="st">"Tiny Problems"</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>CrpOrdFor <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>num.Quality <span class="sc">~</span> test<span class="sc">$</span>num.predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>model.metrics.all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.metrics.all, <span class="fu">numerical.Metrics</span>(test, <span class="st">"Crop Ord Rand For"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 111  17
         1  29 319
                                          
               Accuracy : 0.9034          
                 95% CI : (0.8732, 0.9284)
    No Information Rate : 0.7059          
    P-Value [Acc &gt; NIR] : &lt;2e-16          
                                          
                  Kappa : 0.7613          
                                          
 Mcnemar's Test P-Value : 0.1048          
                                          
            Sensitivity : 0.9494          
            Specificity : 0.7929          
         Pos Pred Value : 0.9167          
         Neg Pred Value : 0.8672          
              Precision : 0.9167          
                 Recall : 0.9494          
                     F1 : 0.9327          
             Prevalence : 0.7059          
         Detection Rate : 0.6702          
   Detection Prevalence : 0.7311          
      Balanced Accuracy : 0.8711          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
</div>
</section>
<section id="cropped-binary-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="cropped-binary-random-forest">Cropped Binary Random Forest</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-69_ca81b7f5f749c7d2f03e055fead01c61">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>crop.num.RF.model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(num.Quality <span class="sc">~</span> assess_percentile_na_proportion <span class="sc">+</span> assess_col_na_cropped <span class="sc">+</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>                         extract_na_cropped <span class="sc">+</span> assess_middle_na_proportion <span class="sc">+</span> assess_bottomempty_cropped <span class="sc">+</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>                         assess_median_na_proportion, <span class="at">data =</span> train,</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>test<span class="sc">$</span>num.predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(crop.num.RF.model, test, <span class="at">type=</span><span class="st">"prob"</span>)[,<span class="dv">2</span>]</span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>CrpNumFor <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>num.Quality <span class="sc">~</span> test<span class="sc">$</span>num.predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>test[test<span class="sc">$</span>num.predictions <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">&amp;</span> test<span class="sc">$</span>num.Quality <span class="sc">==</span> <span class="dv">1</span>, ]<span class="sc">$</span>followup <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>test[test<span class="sc">$</span>num.predictions <span class="sc">&gt;</span> <span class="fl">0.75</span> <span class="sc">&amp;</span> test<span class="sc">$</span>num.Quality <span class="sc">==</span> <span class="dv">0</span>, ]<span class="sc">$</span>followup <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test, <span class="fu">aes</span>(<span class="at">x=</span>num.Quality, <span class="at">y=</span>num.predictions)) <span class="sc">+</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"True Quality"</span>) <span class="sc">+</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability of good scan"</span>) <span class="sc">+</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Numerical Logistic Prediction Test Data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test, <span class="fu">aes</span>(<span class="at">x=</span>num.Quality, <span class="at">y=</span>num.predictions, <span class="at">color=</span>followup)) <span class="sc">+</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">"grey50"</span>, <span class="st">"darkorange"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-69-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The boxplot shows a general picture of the results of the model. There is a significant number of misclassified scans. Using a typical 0.5 rounding we get the confusion matrix:</p>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-70_6054c496d75c7d0f3d7f7c2d8257ca81">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>model.metrics.all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(model.metrics.all, <span class="fu">numerical.Metrics</span>(test, <span class="st">"Crop Binary Rand For"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 117  23
         1  23 313
                                          
               Accuracy : 0.9034          
                 95% CI : (0.8732, 0.9284)
    No Information Rate : 0.7059          
    P-Value [Acc &gt; NIR] : &lt;2e-16          
                                          
                  Kappa : 0.7673          
                                          
 Mcnemar's Test P-Value : 1               
                                          
            Sensitivity : 0.9315          
            Specificity : 0.8357          
         Pos Pred Value : 0.9315          
         Neg Pred Value : 0.8357          
              Precision : 0.9315          
                 Recall : 0.9315          
                     F1 : 0.9315          
             Prevalence : 0.7059          
         Detection Rate : 0.6576          
   Detection Prevalence : 0.7059          
      Balanced Accuracy : 0.8836          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
</div>
</section>
<section id="cropped-model-results" class="level3">
<h3 class="anchored" data-anchor-id="cropped-model-results">Cropped Model Results</h3>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-72_57e692e15d8c75f150ee81366a7f4647">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(<span class="fu">list</span>(<span class="at">CrpMultiLog =</span> CrpMultiLog, <span class="at">CrpBinLog =</span> CrpBinLog,</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">CrpNumFor =</span> CrpNumFor, <span class="at">CrpOrdFor =</span> CrpOrdFor))<span class="sc">+</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sensitivity"</span>,</span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Specificity"</span>,</span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Comparison of Cropped Quality Prediction Models"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="final-results" class="level2">
<h2 class="anchored" data-anchor-id="final-results">Final Results</h2>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-73_6fe386fec7f98579e53f4e422757eb9a">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(model.metrics.all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: left;">TPR</th>
<th style="text-align: left;">TNR</th>
<th style="text-align: left;">F1</th>
<th style="text-align: left;">Kappa</th>
<th style="text-align: left;">AUC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Stnd Multi Log Reg</td>
<td style="text-align: left;">0.9821</td>
<td style="text-align: left;">0.6786</td>
<td style="text-align: left;">0.9283</td>
<td style="text-align: left;">0.7191</td>
<td style="text-align: left;">0.8304</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stnd Binary Log Reg</td>
<td style="text-align: left;">0.9643</td>
<td style="text-align: left;">0.7714</td>
<td style="text-align: left;">0.9364</td>
<td style="text-align: left;">0.7677</td>
<td style="text-align: left;">0.9533</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stnd Ord Rand For</td>
<td style="text-align: left;">0.9405</td>
<td style="text-align: left;">0.8214</td>
<td style="text-align: left;">0.9335</td>
<td style="text-align: left;">0.7699</td>
<td style="text-align: left;">0.881</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stnd Binary Rand For</td>
<td style="text-align: left;">0.9286</td>
<td style="text-align: left;">0.8286</td>
<td style="text-align: left;">0.9286</td>
<td style="text-align: left;">0.7571</td>
<td style="text-align: left;">0.9477</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Crop Multi Logistic Reg</td>
<td style="text-align: left;">0.9821</td>
<td style="text-align: left;">0.7</td>
<td style="text-align: left;">0.9322</td>
<td style="text-align: left;">0.7375</td>
<td style="text-align: left;">0.8411</td>
</tr>
<tr class="even">
<td style="text-align: left;">Crop Binary Logistic Reg</td>
<td style="text-align: left;">0.9554</td>
<td style="text-align: left;">0.7929</td>
<td style="text-align: left;">0.9359</td>
<td style="text-align: left;">0.7707</td>
<td style="text-align: left;">0.9514</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Crop Ord Rand For</td>
<td style="text-align: left;">0.9494</td>
<td style="text-align: left;">0.7929</td>
<td style="text-align: left;">0.9327</td>
<td style="text-align: left;">0.7613</td>
<td style="text-align: left;">0.8711</td>
</tr>
<tr class="even">
<td style="text-align: left;">Crop Binary Rand For</td>
<td style="text-align: left;">0.9315</td>
<td style="text-align: left;">0.8357</td>
<td style="text-align: left;">0.9315</td>
<td style="text-align: left;">0.7673</td>
<td style="text-align: left;">0.9499</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/all-model-roc-curve_d61650643d3f795b7114838e886b7010">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(<span class="fu">list</span>(<span class="at">CrpMultiLog =</span> CrpMultiLog, <span class="at">CrpBinLog =</span> CrpBinLog,</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">CrpNumFor =</span> CrpNumFor, <span class="at">CrpOrdFor =</span> CrpOrdFor,</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">StndMultiLog =</span> StndMultiLog, <span class="at">StndBinLog =</span> StndBinLog,</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">StndNumFor =</span> StndNumFor, <span class="at">StndOrdFor =</span> StndOrdFor</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>           ))<span class="sc">+</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sensitivity"</span>,</span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Specificity"</span>,</span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Comparison of All Quality Prediction Models"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/all-model-roc-curve-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="Model-Comparison_cache/html/unnamed-chunk-74_ff4f9d2e4e61f383f957781b528adc1b">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggroc</span>(<span class="fu">list</span>(<span class="at">CrpMultiLog =</span> CrpMultiLog, <span class="at">CrpOrdFor =</span> CrpOrdFor,</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">StndMultiLog =</span> StndMultiLog, <span class="at">StndOrdFor =</span> StndOrdFor</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>           ))<span class="sc">+</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.4</span>)))<span class="sc">+</span></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">1.6</span>)))<span class="sc">+</span></span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>),</span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype=</span><span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sensitivity"</span>,</span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Specificity"</span>,</span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title=</span><span class="st">"Comparison of Triangular Quality Models"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Model-Comparison_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="followup-scans" class="level2">
<h2 class="anchored" data-anchor-id="followup-scans">Followup Scans</h2>
<ul>
<li><span style="color: red;">XXX Probably need to do something here.</span></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>